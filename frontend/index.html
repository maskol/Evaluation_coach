<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluation Coach - Agile Team Analytics</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéØ</text></svg>">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>üéØ Evaluation Coach</h1>
            <p>AI-powered Agile & SAFe Analytics Platform</p>
        </div>

        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Active Context Display -->
                <div class="active-context">
                    <div class="active-context-title">Active Context</div>
                    <div class="active-context-content" id="activeContext">
                        Portfolio: All ARTs<br>
                        Time Range: Last PI<br>
                        Focus: Flow Efficiency
                    </div>
                </div>

                <!-- Scope Selection -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Analysis Scope</div>
                    <button class="sidebar-button active" onclick="selectScope('portfolio')">
                        üìä Portfolio View
                    </button>
                    <button class="sidebar-button" onclick="selectScope('art')">
                        üîÑ ART View
                    </button>
                    <button class="sidebar-button" onclick="selectScope('team')">
                        üë• Team View
                    </button>
                </div>

                <!-- ART Selection -->
                <div class="sidebar-section" id="artSelection" style="display: none;">
                    <div class="sidebar-title">Select ART</div>
                    <select class="sidebar-input" id="artSelector" onchange="updateContext()">
                        <option value="">-- Select ART --</option>
                        <!-- ARTs will be loaded dynamically from API -->
                    </select>
                </div>

                <!-- Team Selection -->
                <div class="sidebar-section" id="teamSelection" style="display: none;">
                    <div class="sidebar-title">Select Team</div>
                    <select class="sidebar-input" id="teamSelector" onchange="updateContext()">
                        <option value="">-- Select Team --</option>
                        <!-- Teams will be loaded dynamically from API -->
                    </select>
                </div>

                <!-- PI Selection -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Program Increments (24Q1+)</div>
                    <div id="piSelector">
                        <!-- PI checkboxes will be loaded dynamically from API -->
                        <div style="padding: 16px; color: #666; text-align: center; font-size: 14px;">
                            Loading PIs...
                        </div>
                    </div>
                </div>

                <!-- Metric Focus -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Metric Focus</div>
                    <button class="sidebar-button" onclick="setMetricFocus('flow')">
                        üìà Flow Metrics
                    </button>
                    <button class="sidebar-button" onclick="setMetricFocus('predictability')">
                        üéØ Predictability
                    </button>
                    <button class="sidebar-button" onclick="setMetricFocus('quality')">
                        ‚úÖ Quality Metrics
                    </button>
                    <button class="sidebar-button" onclick="setMetricFocus('dependencies')">
                        üîó Dependencies
                    </button>
                </div>

                <!-- Quick Actions -->
                <div class="sidebar-section">
                    <div class="sidebar-title">Quick Actions</div>
                    <button class="sidebar-button" onclick="generateScorecard()">
                        üìã Generate Scorecard
                    </button>
                    <button class="sidebar-button" onclick="generateInsights()">
                        üí° Generate Insights
                    </button>
                    <button class="sidebar-button" onclick="openPIReportDialog()">
                        üìä Generate PI Report
                    </button>
                    <button class="sidebar-button" onclick="exportReport()">
                        üì• Export Report
                    </button>
                </div>
            </div>

            <!-- Main Chat/Dashboard Area -->
            <div class="chat-area">
                <!-- Main Tabs -->
                <div class="main-tabs">
                    <button class="main-tab active" onclick="switchMainTab('dashboard')">
                        üìä Dashboard
                    </button>
                    <button class="main-tab" onclick="switchMainTab('chat')">
                        üí¨ AI Coach
                    </button>
                    <button class="main-tab" onclick="switchMainTab('insights')">
                        üí° Insights
                    </button>
                    <button class="main-tab" onclick="switchMainTab('littleslaw')">
                        üî¨ Little's Law
                    </button>
                    <button class="main-tab" onclick="switchMainTab('metrics')">
                        üìà Metrics
                    </button>
                    <button class="main-tab" onclick="switchMainTab('admin')">
                        ‚öôÔ∏è Admin
                    </button>
                </div>

                <!-- Dashboard Tab Content -->
                <div class="main-tab-content" id="dashboardContent">
                    <div class="messages">
                        <div class="active-context-inline">
                            <div class="active-context-title-inline">Current Analysis Context</div>
                            <div class="active-context-content-inline" id="inlineContext">
                                Scope: Portfolio | Time: Last PI | Focus: Flow Efficiency
                            </div>
                        </div>

                        <h2 style="margin-bottom: 20px; color: #333;">Portfolio Health Dashboard</h2>

                        <!-- Active Filters Display -->
                        <div id="activeFiltersDisplay"
                            style="display: none; background: #e3f2fd; padding: 12px; border-radius: 8px; margin-bottom: 16px; border-left: 4px solid #2196F3;">
                            <strong>Active Filters:</strong> <span id="activeFiltersText"></span>
                        </div>

                        <div id="portfolioMetrics"
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; margin-bottom: 24px;">
                            <!-- Metrics will be loaded dynamically from API -->
                            <div
                                style="background: #f8f9fa; padding: 20px; border-radius: 12px; color: #666; text-align: center;">
                                Loading metrics from API...
                            </div>
                        </div>

                        <!-- ART Comparison -->
                        <h3 style="margin-bottom: 16px; color: #333;">ART Performance Comparison</h3>
                        <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                            <table style="width: 100%; border-collapse: collapse;">
                                <thead>
                                    <tr style="text-align: left; border-bottom: 2px solid #dee2e6;">
                                        <th style="padding: 12px;">ART</th>
                                        <th style="padding: 12px; cursor: help;"
                                            title="Percentage of time spent on value-adding work vs. waiting. Higher is better. Value-add stages: in_progress + in_reviewing.">
                                            Flow Efficiency</th>
                                        <th style="padding: 12px; cursor: help;"
                                            title="Planning accuracy: percentage of committed features (planned_committed=1) that were delivered (plc_delivery=1). Measures predictability and planning effectiveness. Target: 80%+">
                                            Planning Accuracy</th>
                                        <th style="padding: 12px; cursor: help;"
                                            title="Average lead-time for delivered features from start to completion. Lower is better. Target: ‚â§30 days, Max acceptable: 60 days">
                                            Avg Lead-Time</th>
                                        <th style="padding: 12px; cursor: help;"
                                            title="Number of features completed and delivered in the selected time period">
                                            Features Delivered</th>
                                        <th style="padding: 12px; cursor: help;"
                                            title="Quality score based on lead time consistency. Lower variability indicates better quality and process stability. Range: 0-100%">
                                            Quality</th>
                                        <th style="padding: 12px; cursor: help;"
                                            title="Overall health status based on Planning Accuracy: Healthy (‚â•70%), Warning (50-69%), Critical (<50%)">
                                            Status</th>
                                    </tr>
                                </thead>
                                <tbody id="artComparisonBody">
                                    <!-- ART data will be loaded dynamically from API -->
                                    <tr>
                                        <td colspan="7" style="padding: 20px; text-align: center; color: #666;">
                                            Loading ART data from API...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Recent Insights -->
                        <h3 style="margin-bottom: 16px; color: #333;">Recent Insights</h3>
                        <div id="recentInsights">
                            <!-- Insights will be loaded dynamically from API -->
                            <div
                                style="background: #f8f9fa; padding: 16px; border-radius: 4px; color: #666; text-align: center;">
                                Loading insights from API...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Chat Tab Content -->
                <div class="main-tab-content" id="chatContent" style="display: none;">
                    <div class="messages" id="chatMessages">
                        <div class="message agent">
                            <div class="message-content">
                                üëã Hello! I'm your AI Evaluation Coach. I can help you:
                                <ul style="margin-top: 8px; padding-left: 20px;">
                                    <li>Analyze flow metrics and identify bottlenecks</li>
                                    <li>Generate health scorecards for Portfolio/ART/Team</li>
                                    <li>Provide evidence-based improvement recommendations</li>
                                    <li>Answer questions about your Jira data and trends</li>
                                </ul>
                                What would you like to explore today?
                            </div>
                        </div>
                    </div>
                    <div class="input-area">
                        <form class="input-form" onsubmit="sendMessage(event)">
                            <input type="text" class="input-field" id="messageInput"
                                placeholder="Ask me about your team's performance, metrics, or improvements..."
                                autocomplete="off">
                            <button type="submit" class="send-button" id="sendButton">
                                Send
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Insights Tab Content -->
                <div class="main-tab-content" id="insightsContent" style="display: none;">
                    <div class="messages">
                        <div class="active-context-inline">
                            <div class="active-context-title-inline">Insight Filters</div>
                            <div class="active-context-content-inline">
                                Severity: All | Confidence: High | Scope: Portfolio
                            </div>
                        </div>

                        <h2 style="margin-bottom: 20px; color: #333;">Actionable Insights</h2>

                        <!-- Insight Card 1 -->
                        <div
                            style="background: white; border: 2px solid #FF3B30; border-radius: 8px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(255, 59, 48, 0.1);">
                            <div
                                style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                <h3 style="color: #FF3B30; margin: 0;">High WIP Across Multiple Teams</h3>
                                <span
                                    style="background: #FF3B30; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 600;">CRITICAL</span>
                            </div>
                            <div style="display: flex; gap: 16px; margin-bottom: 12px; font-size: 14px;">
                                <span>üéØ Confidence: <strong>92%</strong></span>
                                <span>üìä Scope: <strong>ART</strong></span>
                                <span>‚è±Ô∏è Impact: <strong>Immediate</strong></span>
                            </div>
                            <p style="color: #333; margin-bottom: 12px; line-height: 1.6;">
                                <strong>Observation:</strong> Customer Experience ART shows WIP ratio of 2.3 (vs
                                target 1.5),
                                affecting 3 teams with combined 43 active stories against 18 person capacity.
                            </p>
                            <p style="color: #333; margin-bottom: 12px; line-height: 1.6;">
                                <strong>Root Cause:</strong> Analysis suggests scattered focus due to external
                                dependencies and
                                lack of WIP limits enforcement in sprint planning.
                            </p>
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                                <strong style="display: block; margin-bottom: 8px; color: #667eea;">Recommended
                                    Actions:</strong>
                                <ul style="padding-left: 20px; line-height: 1.8; color: #555;">
                                    <li><strong>Short-term:</strong> Implement hard WIP limits (1.5x team size) in
                                        next sprint planning</li>
                                    <li><strong>Medium-term:</strong> Review and reduce external dependencies with
                                        dependency mapping</li>
                                    <li><strong>Long-term:</strong> Establish WIP governance and team autonomy
                                        charter</li>
                                </ul>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="template-action-btn" onclick="acceptInsight(1)">‚úì Accept</button>
                                <button class="template-action-btn" onclick="viewDetails(1)">üìã View
                                    Details</button>
                                <button class="template-action-btn" style="background: #8E8E93;"
                                    onclick="dismissInsight(1)">‚úï Dismiss</button>
                            </div>
                        </div>

                        <!-- Insight Card 2 -->
                        <div
                            style="background: white; border: 2px solid #FF9500; border-radius: 8px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(255, 149, 0, 0.1);">
                            <div
                                style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                <h3 style="color: #FF9500; margin: 0;">Increasing Defect Escape Rate</h3>
                                <span
                                    style="background: #FF9500; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 600;">WARNING</span>
                            </div>
                            <div style="display: flex; gap: 16px; margin-bottom: 12px; font-size: 14px;">
                                <span>üéØ Confidence: <strong>87%</strong></span>
                                <span>üìä Scope: <strong>Team</strong></span>
                                <span>‚è±Ô∏è Impact: <strong>Within 2 sprints</strong></span>
                            </div>
                            <p style="color: #333; margin-bottom: 12px; line-height: 1.6;">
                                <strong>Observation:</strong> Mobile Apps team shows 7.2% defect escape rate (vs
                                target 5%),
                                with 12 production defects found in last sprint from 167 delivered stories.
                            </p>
                            <p style="color: #333; margin-bottom: 12px; line-height: 1.6;">
                                <strong>Root Cause:</strong> 68% of escaped defects lack automated test coverage.
                                Team velocity pressure may be reducing testing time.
                            </p>
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                                <strong style="display: block; margin-bottom: 8px; color: #667eea;">Recommended
                                    Actions:</strong>
                                <ul style="padding-left: 20px; line-height: 1.8; color: #555;">
                                    <li><strong>Short-term:</strong> Add Definition of Done checklist requiring test
                                        coverage review</li>
                                    <li><strong>Medium-term:</strong> Establish 80% test coverage target and track
                                        in sprint reviews</li>
                                    <li><strong>Long-term:</strong> Implement automated testing pipeline with
                                        quality gates</li>
                                </ul>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="template-action-btn" onclick="acceptInsight(2)">‚úì Accept</button>
                                <button class="template-action-btn" onclick="viewDetails(2)">üìã View
                                    Details</button>
                                <button class="template-action-btn" style="background: #8E8E93;"
                                    onclick="dismissInsight(2)">‚úï Dismiss</button>
                            </div>
                        </div>

                        <!-- Insight Card 3 -->
                        <div
                            style="background: white; border: 2px solid #34C759; border-radius: 8px; padding: 20px; margin-bottom: 16px; box-shadow: 0 2px 8px rgba(52, 199, 89, 0.1);">
                            <div
                                style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px;">
                                <h3 style="color: #34C759; margin: 0;">Excellent Flow Efficiency Improvement</h3>
                                <span
                                    style="background: #34C759; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 600;">SUCCESS</span>
                            </div>
                            <div style="display: flex; gap: 16px; margin-bottom: 12px; font-size: 14px;">
                                <span>üéØ Confidence: <strong>95%</strong></span>
                                <span>üìä Scope: <strong>ART</strong></span>
                                <span>‚è±Ô∏è Impact: <strong>Sustained</strong></span>
                            </div>
                            <p style="color: #333; margin-bottom: 12px; line-height: 1.6;">
                                <strong>Observation:</strong> Platform Engineering ART achieved 72% flow efficiency
                                (up from 64%),
                                with 28% reduction in blocked time over last 2 PIs.
                            </p>
                            <p style="color: #333; margin-bottom: 12px; line-height: 1.6;">
                                <strong>Success Factors:</strong> Proactive dependency management, cross-team
                                collaboration ceremonies,
                                and dedicated architecture review sessions.
                            </p>
                            <div style="background: #f8f9fa; padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                                <strong style="display: block; margin-bottom: 8px; color: #34C759;">Recommendations
                                    to Sustain:</strong>
                                <ul style="padding-left: 20px; line-height: 1.8; color: #555;">
                                    <li>Document and share best practices with other ARTs</li>
                                    <li>Continue current dependency management cadence</li>
                                    <li>Monitor for regression indicators (blocked time trending up)</li>
                                </ul>
                            </div>
                            <div style="display: flex; gap: 8px;">
                                <button class="template-action-btn" onclick="shareSuccess(3)">üì§ Share
                                    Success</button>
                                <button class="template-action-btn" onclick="viewDetails(3)">üìã View
                                    Details</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Little's Law Tab Content -->
                <div class="main-tab-content" id="littleslawContent" style="display: none;">
                    <div class="messages">
                        <!-- Content will be dynamically loaded by JavaScript -->
                    </div>
                </div>

                <!-- Metrics Tab Content -->
                <div class="main-tab-content" id="metricsContent" style="display: none;">
                    <div class="messages">
                        <h2 style="margin-bottom: 20px; color: #333;">Metrics Catalog</h2>

                        <!-- Metrics Category Tabs -->
                        <div class="action-tabs" style="margin-bottom: 20px;">
                            <button class="action-tab active" onclick="showMetricCategory('flow')">Flow
                                Metrics</button>
                            <button class="action-tab"
                                onclick="showMetricCategory('predictability')">Predictability</button>
                            <button class="action-tab disabled" title="No bug data available">Quality</button>
                            <button class="action-tab" onclick="showMetricCategory('structure')">Structure</button>
                        </div>

                        <!-- Flow Metrics -->
                        <div id="flowMetrics" class="metric-category">
                            <div
                                style="background: #f8f9fa; border-radius: 8px; padding: 40px; text-align: center; color: #666;">
                                <div style="font-size: 32px; margin-bottom: 12px;">üìä</div>
                                <div style="font-size: 16px;">Loading real metrics data...</div>
                                <div style="font-size: 14px; margin-top: 8px;">Switch to Metrics tab to load</div>
                            </div>
                        </div>

                        <!-- Predictability Metrics -->
                        <div id="predictabilityMetrics" class="metric-category" style="display: none;">
                            <div
                                style="background: #f8f9fa; border-radius: 8px; padding: 40px; text-align: center; color: #666;">
                                <div style="font-size: 32px; margin-bottom: 12px;">üéØ</div>
                                <div style="font-size: 16px;">Loading predictability metrics...</div>
                            </div>
                        </div>

                        <!-- Quality Metrics -->
                        <div id="qualityMetrics" class="metric-category" style="display: none;">
                            <div
                                style="background: #f8f9fa; border-radius: 8px; padding: 40px; text-align: center; color: #999;">
                                <div style="font-size: 32px; margin-bottom: 12px; opacity: 0.4;">‚úÖ</div>
                                <div style="font-size: 16px; opacity: 0.6;">Quality metrics unavailable</div>
                                <div style="font-size: 14px; margin-top: 8px; opacity: 0.5;">No bug data available</div>
                            </div>
                        </div>

                        <!-- Structure Metrics -->
                        <div id="structureMetrics" class="metric-category" style="display: none;">
                            <div
                                style="background: #f8f9fa; border-radius: 8px; padding: 40px; text-align: center; color: #666;">
                                <div style="font-size: 32px; margin-bottom: 12px;">üèóÔ∏è</div>
                                <div style="font-size: 16px;">Structure metrics coming soon...</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Tab Content -->
                <div class="main-tab-content" id="adminContent" style="display: none;">
                    <div class="messages">
                        <h2 style="margin-bottom: 20px; color: #333;">‚öôÔ∏è Administration & Configuration</h2>
                        <p style="color: #666; margin-bottom: 32px; font-size: 15px;">Access all configuration and
                            administration tools from the links below.</p>

                        <div
                            style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px;">
                            <!-- System Configuration Card -->
                            <div
                                style="background: linear-gradient(135deg, #34C759 0%, #30B050 100%); padding: 24px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);">
                                <h3 style="margin: 0 0 8px 0; color: white;">‚öôÔ∏è System Configuration</h3>
                                <p style="margin: 0 0 16px 0; opacity: 0.9; font-size: 14px;">Thresholds, strategic
                                    targets, display options, filters, and AI model settings</p>
                                <a href="admin.html"
                                    style="padding: 12px 24px; background: white; color: #34C759; border: none; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; width: fit-content;"
                                    onmouseover="this.style.transform='translateY(-2px)'"
                                    onmouseout="this.style.transform='translateY(0)'">
                                    ‚öôÔ∏è Open Configuration
                                </a>
                            </div>

                            <!-- Prompt Management Card -->
                            <div
                                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 24px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">
                                <h3 style="margin: 0 0 8px 0; color: white;">üéØ LLM Prompt Management</h3>
                                <p style="margin: 0 0 16px 0; opacity: 0.9; font-size: 14px;">View, edit, and version
                                    control all AI Coach prompts with history tracking</p>
                                <a href="prompt_admin.html"
                                    style="padding: 12px 24px; background: white; color: #667eea; border: none; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; width: fit-content;"
                                    onmouseover="this.style.transform='translateY(-2px)'"
                                    onmouseout="this.style.transform='translateY(0)'">
                                    üéØ Manage Prompts
                                </a>
                            </div>

                            <!-- RAG Knowledge Base Card -->
                            <div
                                style="background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%); padding: 24px; border-radius: 12px; color: white; box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);">
                                <h3 style="margin: 0 0 8px 0; color: white;">üìö RAG Knowledge Base</h3>
                                <p style="margin: 0 0 16px 0; opacity: 0.9; font-size: 14px;">Manage the AI Coach's
                                    knowledge base, view documents, and re-index content</p>
                                <a href="rag_admin.html"
                                    style="padding: 12px 24px; background: white; color: #FF6B6B; border: none; border-radius: 8px; text-decoration: none; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); transition: transform 0.2s; width: fit-content;"
                                    onmouseover="this.style.transform='translateY(-2px)'"
                                    onmouseout="this.style.transform='translateY(0)'">
                                    üìö Manage RAG
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <span id="statusText">Ready | Last updated: Just now | Data source: Jira Cloud</span>
        </div>
    </div>

    <!-- Insight Details Modal (hidden by default) -->
    <div id="insightDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h2 id="insightDetailsTitle">Insight Details</h2>
                <button class="modal-close" onclick="closeInsightDetails()">√ó</button>
            </div>
            <div class="modal-body" id="insightDetailsBody">
                <!-- Dynamically populated -->
            </div>
        </div>
    </div>

    <!-- PI Report Modal -->
    <div id="piReportModal" class="modal">
        <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
            <div class="modal-header">
                <h2 id="piReportTitle">üìä Program Increment Management Report</h2>
                <button class="modal-close" onclick="closePIReport()">√ó</button>
            </div>
            <div class="modal-body" id="piReportBody">
                <!-- Dynamically populated -->
            </div>
            <div class="modal-footer"
                style="display: flex; justify-content: space-between; padding: 16px; border-top: 1px solid #eee;">
                <button onclick="printPIReport()"
                    style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                    üñ®Ô∏è Print Report
                </button>
                <button onclick="closePIReport()"
                    style="padding: 10px 20px; background: #8E8E93; color: white; border: none; border-radius: 6px; cursor: pointer;">
                    Close
                </button>
            </div>
        </div>
    </div>

    <!-- PI Report Generation Dialog -->
    <div id="piReportDialog" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üìä Generate PI Report</h2>
                <button class="modal-close" onclick="closePIReportDialog()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 20px; color: #666;">
                    Generate a comprehensive management report analyzing PI performance, comparing with targets and
                    previous PI, and providing actionable proposals.
                </p>

                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">
                        Select PI(s) to Analyze:
                    </label>
                    <div style="display: flex; gap: 12px; margin-bottom: 8px;">
                        <button onclick="selectAllPIs()" type="button"
                            style="padding: 6px 12px; background: #007AFF; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            Select All
                        </button>
                        <button onclick="deselectAllPIs()" type="button"
                            style="padding: 6px 12px; background: #8E8E93; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            Deselect All
                        </button>
                        <button onclick="selectYear2025()" type="button"
                            style="padding: 6px 12px; background: #34C759; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                            2025 Full Year
                        </button>
                    </div>
                    <div id="piReportSelect"
                        style="max-height: 200px; overflow-y: auto; border: 2px solid #ddd; border-radius: 6px; padding: 8px; background: white;">
                        <div style="color: #8E8E93; text-align: center; padding: 20px;">Loading PIs...</div>
                    </div>
                    <div id="piSelectionCount" style="margin-top: 8px; font-size: 12px; color: #8E8E93;">
                        0 PIs selected
                    </div>
                </div>

                <div style="margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; cursor: pointer;">
                        <input type="checkbox" id="comparePrevious" checked
                            style="margin-right: 8px; width: 18px; height: 18px;">
                        <span style="color: #333;">Compare with previous PI</span>
                    </label>
                </div>

                <div style="margin-bottom: 16px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">
                        AI Model (Optional):
                    </label>
                    <select id="piReportModel"
                        style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 6px; font-size: 14px;">
                        <option value="">Loading models...</option>
                    </select>
                    <div style="margin-top: 4px; font-size: 11px; color: #8E8E93;">
                        üí° Checking available models...
                    </div>
                </div>

                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button onclick="generatePIReport()" id="generatePIReportBtn"
                        style="flex: 1; padding: 12px; background: linear-gradient(135deg, #5856D6, #4A48B4); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px;">
                        Generate Report
                    </button>
                    <button onclick="cancelPIReportGeneration()" id="cancelPIReportBtn"
                        style="display: none; padding: 12px 24px; background: #FF3B30; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 14px;">
                        üõë Cancel
                    </button>
                    <button onclick="closePIReportDialog()"
                        style="padding: 12px 24px; background: #8E8E93; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // Handle URL parameters to open specific tabs
        window.addEventListener('load', function () {
            const urlParams = new URLSearchParams(window.location.search);
            const tab = urlParams.get('tab');
            if (tab && typeof switchMainTab === 'function') {
                switchMainTab(tab);
            } else {
                // Ensure dashboard is the default tab if no URL parameter
                if (typeof switchMainTab === 'function') {
                    switchMainTab('dashboard');
                }
            }
        });
    </script>
</body>

</html>